---
- name: Play to install nginx and start the service
  hosts: all
  gather_facts: true
  become: true
  become_method: sudo
  become_user: root
  vars:
    app_name: nginx
  tasks:
    - name: Install nginx on Rocky
      when: ansible_distribution_file_variety == "RedHat"
      yum:
        name: "{{ app_name }}"
        state: latest

    - name: Install nginx on Ubuntu
      when: ansible_distribution_file_variety == "Debian"
      apt:
        name: "{{ app_name }}"
        state: latest

    - name: Start the service nginx
      service:
        name: nginx
        state: started
        enabled: true
    
- name: Play to check nginx connectivity 
  hosts: localhost
  connection: local
  gather_facts: false
  become: false
  vars:
    client_ips:
      - "192.168.56.10"
      - "192.168.56.13"
  tasks:
    - name: Check if the website is running
      loop: "{{ client_ips }}"
      loop_control:
        loop_var: ip_item
      uri:
        url: "http://{{ip_item}}"
        status_code: 200
      register: reg_localhost
    
    - name: Display the output
      debug:
        msg: "{{ reg_localhost }}"
