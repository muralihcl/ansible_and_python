---
- name: Play to install nginx and start the service
  hosts: all
  gather_facts: true
  become: true
  become_method: sudo
  become_user: root
  vars:
    app_name: nginx
  tasks:
    - name: Install nginx on Rocky
      when: ansible_distribution_file_variety == "RedHat"
      yum:
        name: "{{ app_name }}"
        state: latest

    - name: Install nginx on Ubuntu
      when: ansible_distribution_file_variety == "Debian"
      apt:
        name: "{{ app_name }}"
        state: latest

    - name: Start the service nginx
      service:
        name: nginx
        state: started
        enabled: true

    - name: Check if the connectivity to the web service is intact on both the hosts
      delegate_to: localhost
      uri:
        url: "http://{{inventory_hostname}}"
        status_code: 200
      register: reg_localhost

    - name: Display the output
      debug:
        msg: "{{ reg_localhost }}"
